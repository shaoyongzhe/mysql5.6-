# 14.5.1  缓冲池
缓冲池是主存储器中的一个区域，用于在访问时缓存表和索引数据。缓冲池允许直接从内存中处理经常使用的数据，从而加快处理速度。在专用服务器上，通常会将最多80％的物理内存分配给缓冲池。
为了提高大容量读取操作的效率，缓冲池被分成可以容纳多行的页面。为了提高缓存管理的效率，缓冲池被实现为页的链表;使用LRU算法的变体，很少使用的数据在缓存中老化。

了解如何利用缓冲池将频繁访问的数据保存在内存中是MySQL调优的一个重要方面。

## 缓冲池LRU算法
使用最近最少使用（LRU）算法的变体将缓冲池作为列表进行管理。 当需要空间将新页面添加到缓冲池时，最近最少使用的页面被逐出，并且新页面被添加到列表的中间。 此中点插入策略将列表视为两个子列表：
* 在头部，最近访问过的新（“年轻”）页面的子列表
* 在尾部，是最近较少访问的旧页面的子列表


图14.2 InnoDB缓冲池列表

![缓存池列表](../images/innodb-buffer-pool-list.png)

该算法在新子列表中保存查询中大量使用的页面。 旧子列表包含的是较少使用的页面; 这些页面是驱逐的候选人。

默认情况下，算法操作如下：

* 3/8的缓冲池专用于旧子列表。

* 列表的中点是新子列表的尾部与旧子列表的头部相交的边界。

* 当InnoDB将页面读入缓冲池时，它最初将其插入中点（旧子列表的头部）。 一个页面如果被被读入，那是因为它是用户指定的操作（例如SQL查询）所需的，或者是InnoDB自动执行的预读操作的一部分。
* 访问旧子列表中的页面使该页面变得“年轻”，因为会将该页面移动到缓冲池的头部（新子列表的头部）。 如果因为需要而读入页面，则会立即进行第一次访问，并使页面变得年轻。 如果由于预读而读入了页面，则第一次访问不会立即发生（并且在页面被逐出之前可能根本不会发生）。

在数据库运行过程中，缓冲池中的经常不被访问的页会慢慢移动到列表的尾部。 新旧子列表中的页面随着其他页面的变化而变得新鲜。 旧子列表中的页面也会随着页面插入中点而老化。 最终，仍然未使用的页面到达旧子列表的尾部并被逐出。

默认情况下，查询读取的页面会立即移动到新的子列表中，这意味着它们会更长时间地保留在缓冲池中。 表扫描（例如为mysqldump操作执行，或者没有WHERE子句的SELECT语句）可以将大量数据带入缓冲池并逐出相同数量的旧数据，即使新数据从未再次使用过。 类似地，由预读后台线程加载然后仅访问一次的页面移动到新列表的头部。 这些情况可以将经常使用的页面推送到旧的子列表中，在那里它们会被驱逐。 有关优化此行为的信息，请参见第14.8.3.2节“使缓冲池抗扫描”和第14.8.3.3节“配置InnoDB缓冲池预取（预读）”。
InnoDB标准监控输出包含BUFFER POOL AND MEMORY段落中有关缓冲池LRU算法操作的几个字段。 有关详细信息，请参阅使用InnoDB标准监控监视缓冲池。

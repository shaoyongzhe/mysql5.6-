# 14.5.3 自适应哈希索引
自适应散列索引功能使InnoDB能够在系统上执行更多类似内存数据库的工作，并为缓冲池提供适当的工作负载和足够的内存，而不会牺牲事务功能或可靠性。 自适应哈希索引功能由innodb_adaptive_hash_index变量启用，或在服务器启动时由--skip-innodb-adaptive-hash-index关闭。

基于观察到的搜索模式，使用索引关键字的前缀构建哈希索引。 前缀可以是任何长度，并且可能只有B树中的某些值出现在哈希索引中。 哈希索引是根据需要经常访问的索引页面构建的。如果表几乎完全适合主内存，则哈希索引可以通过启用任何元素的直接查找来加速查询，将索引值转换为一种指针。 InnoDB有一种监控索引搜索的机制。 如果InnoDB注意到查询可以从构建哈希索引中受益，那么它会自动执行。

对于某些工作负载，哈希索引查找的加速大大超过了监视索引查找和维护哈希索引结构的额外工作。 在高负载（例如多个并发连接）下，对自适应哈希索引的访问有时会成为争用的来源。 使用LIKE运算符和％通配符查询也不会受益。 对于无法从自适应哈希索引功能中受益的工作负载，将其关闭可减少不必要的性能开销。 由于很难预先预测自适应散列索引功能是否适合特定系统和工作负载，因此请考虑在启用和禁用运行基准测试时运行基准测试。 MySQL 5.6中的体系结构的变更使其更相对于早起版本适合禁用自适应哈希索引功能。

在MySQL 5.7中，自适应哈希索引功能是分区的。 每个索引都绑定到一个特定的分区，每个分区都由一个单独的锁存器保护。 分区由innodb_adaptive_hash_index_parts变量控制。 在早期版本中，自适应哈希索引功能受到单个锁存器的保护，这可能成为繁重工作负载下的争用点。 innodb_adaptive_hash_index_parts变量默认设置为8。 最大设置为512。


您可以在SHOW ENGINE INNODB STATUS输出的SEMAPHORES部分中监视自适应哈希索引的使用和争用。 如果有许多线程在btr0sea.c中创建的RW锁存器上等待，请考虑增加自适应哈希索引分区的数量或禁用自适应哈希索引功能。

有关哈希索引的性能特征的信息，请参见第8.3.8节“B树和哈希索引的比较”。
